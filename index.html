<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortuna</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f0f5f2;
            color: #1a3a2a;
            margin: 0;
            text-align: center;
        }

        .logo-container {
            margin-bottom: 40px;
        }

        .logo-img {
            width: 120px;
            margin-bottom: 20px;
        }

        p {
            font-size: 18px;
            color: #2d5a47;
            max-width: 600px;
        }

        input {
            width: 100%;
            max-width: 600px;
            padding: 16px 20px;
            font-size: 18px;
            border: 2px solid #b8d4c9;
            border-radius: 12px;
            background-color: #ffffff;
            color: #1a3a2a;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #18623a;
            box-shadow: 0 0 8px rgba(24, 98, 58, 0.2);
        }

        input::placeholder {
            color: #7aa896;
        }

        button {
            margin-top: 30px;
            padding: 16px 40px;
            font-size: 20px;
            font-weight: 600;
            background-color: #18623a;
            color: #f0f5f2;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 12px rgba(24, 98, 58, 0.25);
        }

        button:hover {
            background-color: #2a8c52;
            transform: translateY(-2px);
        }

        button:active {
            background-color: #145030;
        }

        #display {
            font-size: 72px;
            font-weight: 700;
            margin: 40px 0;
            min-height: 100px;
            color: #333333;
            transition: color 0.4s ease;
        }

        #logo {
            width: 100%;
            max-width: 250px;
            height: auto;
        }

        .winner {
            color: #000000 !important;
        }

        @keyframes subtle-glow {
            from {
            text-shadow: 0 0 20px rgba(24, 98, 58, 0.2);
            }
            to {
            text-shadow: 0 0 40px rgba(24, 98, 58, 0.4);
            }
        }

        @media (max-width: 768px) {
            #display {
            font-size: 48px;
            }
        }
    </style>
</head>

<body class="bg-white">
    <div class="container">
        <div class="row justify-content-center py-5">

            <div class="row">
                <div class="col-md-4">

                    <img id="logo" src="src/fortuna_logo.png" alt="">
                    <h3>Loto</h3>
                    <div class="text-center mt-4">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://chat.whatsapp.com/GbegcL4XMDZK3xb1mpuKM5"
                            alt="QR de contacto" class="mb-3"
                            style="border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <br>
                        <a href="https://chat.whatsapp.com/GbegcL4XMDZK3xb1mpuKM5" target="_blank"
                            class="btn btn-sm btn-success">Únete en WhatsApp</a>
                        <p class="mt-3 mb-0 text-muted small">© Fortuna</p>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card border-0 shadow-sm p-5"
                        style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 16px;">
                        <p class="fw-500 mb-4">Introduce los participantes separados por comas</p>
                        <input type="text" id="list" placeholder="Ej: Ana, Luis, María, Pedro..." class="mb-4">
                        <button onclick="startDraw()" class="w-100">Iniciar sorteo</button>
                        <div id="display">• • •</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio de ganador -->
    <audio id="winnerSound" preload="auto">
        <source src="src/winner-game-sound-404167.mp3" type="audio/mpeg">
        Tu navegador no soporta audio.
    </audio>

    <script>
        const button = document.querySelector('button');
        const winnerAudio = document.getElementById('winnerSound');

        function startDraw() {
            const input = document.getElementById('list').value.trim();
            const items = input.split(',').map(s => s.trim()).filter(s => s !== '');
            const display = document.getElementById('display');

            if (items.length < 2) {
                alert('Introduce al menos 2 participantes.');
                return;
            }

            // Deshabilitar botón mientras el sorteo está en proceso
            button.disabled = true;

            // Scroll suave al display al comenzar el sorteo
            display.scrollIntoView({ behavior: 'smooth', block: 'center' });

            display.classList.remove('winner');

            // Aleatoriedad criptográfica máxima
            let array = new Uint32Array(1);
            crypto.getRandomValues(array);
            const winnerIndex = array[0] % items.length;

            // Animación rápida y elegante (4-6 segundos máx.)
            const minDelay = 15;
            const maxDelay = 250;
            const extraCycles = 5 + Math.floor(Math.random() * 4);
            const totalTicks = extraCycles * items.length + winnerIndex;

            let currentStep = 0;

            function tick() {
                const index = currentStep % items.length;
                display.innerText = items[index];
                display.style.color = '#333333';

                currentStep++;

                if (currentStep >= totalTicks) {
                    display.innerText = items[winnerIndex];
                    display.classList.add('winner');

                    setTimeout(() => {
                        display.innerText = items[winnerIndex] + " ¡Ganador!";
                        winnerAudio.currentTime = 0;
                        winnerAudio.play().catch(e => console.log("Audio bloqueado:", e));
                        button.disabled = false;
                    }, 400);
                    return;
                }

                const progress = currentStep / totalTicks;
                const delay = minDelay + (maxDelay - minDelay) * Math.pow(progress, 2);

                setTimeout(tick, delay);
            }

            display.innerText = "...";
            setTimeout(tick, 600);
        }
    </script>
</body>

</html>